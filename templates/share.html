{% extends "base.html" %}

{% block title %}Share - {{ post.title }}{% endblock %}

{% block content %}
<div class="main-content share-page">
    <article class="post">
        {% if post.is_video and (post.hls_url or post.video_url) %}
        <div class="post-media video-container" data-hls-url="{{ post.hls_url }}" data-audio-url="{{ post.audio_url }}">
            <video class="post-video" src="{{ post.video_url }}" loop playsinline autoplay muted></video>
            {% if post.audio_url %}
            <audio class="video-audio" src="{{ post.audio_url }}" style="display:none;" loop muted></audio>
            {% endif %}
            <div class="video-controls">
                <div class="video-timeline">
                    <div class="video-progress"></div>
                </div>
                <div class="video-volume-container">
                    <button class="video-btn video-mute" aria-label="Mute">ðŸ”‡</button>
                    <input type="range" class="video-volume-slider" min="0" max="100" value="0">
                </div>
                <div class="video-speed-container">
                    <button class="video-btn video-speed-decrease" aria-label="Decrease speed">âˆ’</button>
                    <div class="video-speed-display">1x</div>
                    <button class="video-btn video-speed-increase" aria-label="Increase speed">+</button>
                </div>
                <button class="video-btn video-fullscreen" aria-label="Fullscreen">â›¶</button>
            </div>
        </div>
        {% elif post.gallery_urls and post.gallery_urls|length > 0 %}
        <div class="post-media gallery">
            <div class="gallery-preview" tabindex="0" role="button" aria-expanded="false">
                <div class="gallery-preview-main">
                    <img class="gallery-image preview-main" src="{{ post.gallery_urls[0] }}" alt="Gallery image" loading="lazy">
                </div>
                {% if post.gallery_urls|length > 1 %}
                <div class="gallery-preview-peek">
                    <img class="gallery-image preview-peek" src="{{ post.gallery_urls[1] }}" alt="Gallery image peek" loading="lazy">
                    {% if post.gallery_urls|length > 2 %}
                    <div class="gallery-more-count">+{{ post.gallery_urls|length - 1 }}</div>
                    {% endif %}
                </div>
                {% endif %}
            </div>

            <div class="gallery-scroll gallery-full" hidden>
                {% for url in post.gallery_urls %}
                <div class="gallery-item">
                    <img class="gallery-image" src="{{ url }}" alt="Gallery image" loading="lazy">
                </div>
                {% endfor %}
            </div>
        </div>
        {% elif post.image_url %}
        <div class="post-media">
            <img class="post-image" src="{{ post.image_url }}" alt="Post image">
        </div>
        {% endif %}
        
        <h2 class="post-title"><span class="post-title-text">{{ post.title }}</span></h2>

        <div class="post-meta">
            <span class="post-meta-item"><a href="{{ url_for('subreddit', name=post.subreddit) }}" class="subreddit-link-inline">r/{{ post.subreddit }}</a></span>
            <span class="post-meta-item">
                {% if post.author and post.author != "[deleted]" %}
                <a href="{{ url_for('user_profile', username=post.author) }}" class="comment-author">u/{{ post.author }}</a>
                {% else %}
                <span class="comment-author">u/{{ post.author }}</span>
                {% endif %}
            </span>
        </div>
        
        {% if post.selftext %}
        <div class="post-selftext">
            {{ post.selftext | format_content | safe }}
        </div>
        {% endif %}

        <div class="share-actions" style="margin-top: 12px;">
            <a href="{{ post_url }}" class="btn btn-primary">View full post</a>
            <a href="{{ post.permalink }}" target="_blank" class="btn">View on Reddit</a>
            <span id="copy-feedback" class="text-secondary" style="margin-left:8px; display:none;">Copied!</span>
        </div>
    </article>
</div>
{% endblock %}
