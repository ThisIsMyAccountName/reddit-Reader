{% extends "base.html" %}

{% block title %}{{ post.title }} - Reddit Reader{% endblock %}

{% block content %}
<div class="main-content" style="margin: 0 auto;">
<div style="margin-bottom: 20px;">
    <a href="{{ url_for('subreddit', name=post.subreddit) }}" class="btn">
        â† Back to r/{{ post.subreddit }}
    </a>
</div>

<article class="post-detail">
    <h1 style="font-size: 24px; margin-bottom: 15px;">{{ post.title }}</h1>
    
    <div class="post-meta">
        <span class="post-meta-item">
            ğŸ‘¤ <span class="post-author">u/{{ post.author }}</span>
        </span>
        <span class="post-meta-item">
            ğŸ“ r/{{ post.subreddit }}
        </span>
        <span class="post-meta-item">
            â¬†ï¸ {{ "{:,}".format(post.score) }}
        </span>
        <span class="post-meta-item">
            ğŸ’¬ {{ "{:,}".format(post.num_comments) }} comments
        </span>
        <span class="post-meta-item">
            ğŸ• {{ reader.format_timestamp(post.created_utc) }}
        </span>
    </div>
    
    {% if post.is_video and (post.hls_url or post.video_url) %}
    <div class="post-media video-container" style="margin-top: 15px;" data-hls-url="{{ post.hls_url }}" data-audio-url="{{ post.audio_url }}">
        <video class="post-video" src="{{ post.video_url }}" loop playsinline autoplay muted></video>
        {% if post.audio_url %}
        <audio class="video-audio" src="{{ post.audio_url }}" style="display:none;" loop muted></audio>
        {% endif %}
        <div class="video-controls">
            <button class="video-btn video-play-pause" aria-label="Play/Pause">â¸</button>
            <div class="video-timeline">
                <div class="video-progress"></div>
            </div>
            <div class="video-volume-container">
                <button class="video-btn video-mute" aria-label="Mute">ğŸ”‡</button>
                <input type="range" class="video-volume-slider" min="0" max="100" value="0">
            </div>
            <div class="video-speed-container">
                <select class="video-speed-select" aria-label="Playback speed">
                    <option value="0.25">0.25x</option>
                    <option value="0.5">0.5x</option>
                    <option value="0.75">0.75x</option>
                    <option value="1" selected>1x</option>
                    <option value="1.25">1.25x</option>
                    <option value="1.5">1.5x</option>
                    <option value="1.75">1.75x</option>
                    <option value="2">2x</option>
                </select>
            </div>
            <button class="video-btn video-fullscreen" aria-label="Fullscreen">â›¶</button>
        </div>
    </div>
    {% elif post.gallery_urls and post.gallery_urls|length > 0 %}
    <div class="post-media gallery" style="margin-top: 15px;">
        <div class="gallery-scroll">
            {% for url in post.gallery_urls %}
            <div class="gallery-item">
                <img class="gallery-image" src="{{ url }}" alt="Gallery image" loading="lazy">
            </div>
            {% endfor %}
        </div>
        {% if post.gallery_urls|length > 1 %}
        <button class="gallery-nav gallery-nav-left" aria-label="Previous image">â€¹</button>
        <button class="gallery-nav gallery-nav-right" aria-label="Next image">â€º</button>
        {% endif %}
    </div>
    {% elif post.image_url %}
    <div class="post-media" style="margin-top: 15px;">
        <img class="post-image" src="{{ post.image_url }}" alt="Post image">
    </div>
    {% endif %}

    {% if post.selftext %}
    <div class="post-selftext" style="border-top: 1px solid var(--border); margin-top: 15px; padding-top: 15px;">
        {{ post.selftext | format_content | safe }}
    </div>
    {% endif %}
    
    <div class="post-actions">
        {% if not post.is_self %}
        <a href="{{ post.url }}" target="_blank" class="btn btn-primary">
            ğŸ”— View Link
        </a>
        {% endif %}
        <a href="{{ url_for('share_post', subreddit=post.subreddit, post_id=post.id) }}" class="btn">
            ğŸ” Share
        </a>
        <a href="{{ post.permalink }}" target="_blank" class="btn">
            ğŸ”— View on Reddit
        </a>
    </div>
</article>

<h2 style="margin-bottom: 15px; font-size: 20px;">
    ğŸ’¬ Comments ({{ comments|length }})
</h2>

{% if comments %}
    {% for comment in comments %}
    <div class="comment" data-depth="{{ comment.depth }}">
        <div class="comment-content">
            <div class="comment-meta-right">
                {% if comment.author and comment.author != "[deleted]" %}
                <a href="{{ url_for('user_profile', username=comment.author) }}" class="comment-author">u/{{ comment.author }}</a>
                {% else %}
                <span class="comment-author">u/{{ comment.author }}</span>
                {% endif %}
                <span class="comment-score">â¬†ï¸ {{ "{:,}".format(comment.score) }}</span>
            </div>
            <div class="comment-body">{{ comment.body | format_content | safe }}</div>
            {% if comment.replies %}
            <div class="comment-replies">
                {% for reply in comment.replies %}
                    {% include 'comment_tree.html' %}
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
    {% endfor %}
{% else %}
    <div style="text-align: center; padding: 40px; color: var(--text-secondary);">
        <p>No comments yet</p>
    </div>
{% endif %}
</div>
{% endblock %}
