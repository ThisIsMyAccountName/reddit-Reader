{% extends "base.html" %}

{% block title %}r/{{ subreddit }} - Reddit Reader{% endblock %}

{% block content %}
<h1 style="margin-bottom: 20px;">r/{{ subreddit }}</h1>

<div class="controls">
    <span class="text-secondary">Sort by:</span>
    <a href="{{ url_for('subreddit', name=subreddit, sort='hot') }}" 
       class="sort-link {% if sort == 'hot' %}active{% endif %}">ğŸ”¥ Hot</a>
    <a href="{{ url_for('subreddit', name=subreddit, sort='new') }}" 
       class="sort-link {% if sort == 'new' %}active{% endif %}">ğŸ†• New</a>
    <a href="{{ url_for('subreddit', name=subreddit, sort='top') }}" 
       class="sort-link {% if sort == 'top' %}active{% endif %}">â­ Top</a>
    <a href="{{ url_for('subreddit', name=subreddit, sort='rising') }}" 
       class="sort-link {% if sort == 'rising' %}active{% endif %}">ğŸ“ˆ Rising</a>
</div>

{% if posts %}
    {% for post in posts %}
    <article class="post">
        <h2 class="post-title">
            <a href="{{ url_for('comments', subreddit=post.subreddit, post_id=post.id) }}">
                {{ post.title }}
            </a>
        </h2>
        
        <div class="post-meta">
            <span class="post-meta-item">
                ğŸ‘¤ <span class="post-author">u/{{ post.author }}</span>
            </span>
            <span class="post-meta-item">
                ğŸ“ r/{{ post.subreddit }}
            </span>
            <span class="post-meta-item">
                â¬†ï¸ {{ "{:,}".format(post.score) }}
            </span>
            <span class="post-meta-item">
                ğŸ’¬ {{ "{:,}".format(post.num_comments) }} comments
            </span>
            <span class="post-meta-item">
                ğŸ• {{ reader.format_timestamp(post.created_utc) }}
            </span>
        </div>
        
        {% if post.is_self and post.selftext %}
        <div class="post-selftext">
            {{ post.selftext[:300] }}{% if post.selftext|length > 300 %}...{% endif %}
        </div>
        {% endif %}

        {% if post.is_video and post.video_url %}
        <div class="post-media video-container">
            <video class="post-video" src="{{ post.video_url }}" loop playsinline></video>
            {% if post.audio_url %}
            <audio class="video-audio" src="{{ post.audio_url }}" style="display:none;"></audio>
            {% endif %}
            <button class="media-download-btn" data-url="{{ post.video_url }}" data-type="video" title="Download" aria-label="Download">
                â¤“
            </button>
            <div class="video-controls">
                <button class="video-btn video-play-pause" aria-label="Play/Pause">â¸</button>
                <div class="video-timeline">
                    <div class="video-progress"></div>
                </div>
                <div class="video-volume-container">
                    <button class="video-btn video-mute" aria-label="Mute">ï¿½</button>
                    <input type="range" class="video-volume-slider" min="0" max="100" value="30">
                </div>
                <button class="video-btn video-speed" aria-label="Playback speed">1x</button>
                <button class="video-btn video-fullscreen" aria-label="Fullscreen">â›¶</button>
            </div>
        </div>
        {% elif post.gallery_urls and post.gallery_urls|length > 0 %}
        <div class="post-media gallery">
            <div class="gallery-scroll">
                {% for url in post.gallery_urls %}
                <div class="gallery-item">
                    <img class="gallery-image" src="{{ url }}" alt="Gallery image" loading="lazy">
                    <button class="media-download-btn" data-url="{{ url }}" data-type="image" title="Download" aria-label="Download">
                        â¤“
                    </button>
                </div>
                {% endfor %}
            </div>
            {% if post.gallery_urls|length > 1 %}
            <button class="gallery-nav gallery-nav-left" aria-label="Previous image">â€¹</button>
            <button class="gallery-nav gallery-nav-right" aria-label="Next image">â€º</button>
            {% endif %}
        </div>
        {% elif post.image_url %}
        <div class="post-media">
            <img class="post-image" src="{{ post.image_url }}" alt="Post image">
            <button class="media-download-btn" data-url="{{ post.image_url }}" data-type="image" title="Download" aria-label="Download">
                â¤“
            </button>
        </div>
        {% endif %}
        
        <div class="post-actions">
            <a href="{{ url_for('comments', subreddit=post.subreddit, post_id=post.id) }}" 
               class="btn btn-primary">
                ğŸ’¬ View Comments
            </a>
            {% if not post.is_self %}
            <a href="{{ post.url }}" target="_blank" class="btn">
                ğŸ”— View Link
            </a>
            {% endif %}
            <a href="{{ post.permalink }}" target="_blank" class="btn">
                ğŸ”— Reddit
            </a>
        </div>

        <div class="post-top-comments">
            <div class="post-top-comments-title">Top comments</div>
            <button class="btn comment-toggle"
                    data-subreddit="{{ post.subreddit }}"
                    data-post-id="{{ post.id }}"
                    data-limit="{{ comments_limit }}">
                Load comments
            </button>
            <div class="comment-list" data-show-author="false" hidden></div>
        </div>
    </article>
    {% endfor %}
{% else %}
    <div class="error-container">
        <div class="error-title">ğŸ˜•</div>
        <p class="error-message">No posts found for r/{{ subreddit }}</p>
        <a href="{{ url_for('index') }}" class="btn btn-primary">Go to r/all</a>
    </div>
{% endif %}
{% endblock %}
